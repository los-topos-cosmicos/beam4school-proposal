# BeamScan â€” Simulation & Automation Plan

## For the BL4S 2026 team in CÃ³rdoba, Argentina

---

## 1. Overview: What This System Does

The BeamScan simulation system turns a simple text file into physics predictions and plots â€” automatically, in the cloud, with no software installation required.

```
STUDENT                           GITHUB                        RESULT
â”â”â”â”â”â”â”â”                          â”â”â”â”â”â”                        â”â”â”â”â”â”
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”
 Edit YAML file â”€â”€â”€â”€ git push â”€â”€â”€â–ºâ”‚ GitHub Actions    â”‚
 in requests/                     â”‚                   â”‚
                                  â”‚ 1. Parse YAML     â”‚â”€â”€â”€â–º predictions.csv
                                  â”‚ 2. Highland calc  â”‚â”€â”€â”€â–º distributions.png
                                  â”‚ 3. Plot generator â”‚â”€â”€â”€â–º classification.png
                                  â”‚ 4. PR commenter   â”‚â”€â”€â”€â–º SUMMARY.md
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”€â”€â”˜          â”‚
                                                                 â”‚
 See results â—„â”€â”€â”€â”€ PR comment â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”€â”˜
 on GitHub         with plots
```

### Two Tiers

| Tier | What runs | Speed | Accuracy | Who triggers it |
|------|-----------|-------|----------|-----------------|
| **Highland** (Tier 1) | Python analytical formula | ~30 seconds | Gaussian core only (no tails) | Automatic on every push |
| **Geant4** (Tier 2) | Full Monte Carlo in Docker | ~5â€“15 min | Full physics (MoliÃ¨re tails, Î´-rays, energy loss) | Manual trigger by teacher |

**Students interact exclusively with Tier 1** (fast, instant feedback). Tier 2 is for final validation before the proposal deadline.

---

## 2. Repository Structure

```
bl4s-beamscan/
â”‚
â”œâ”€â”€ .github/workflows/
â”‚   â”œâ”€â”€ highland-predict.yml     â† AUTO: runs on every push to requests/
â”‚   â””â”€â”€ geant4-simulate.yml      â† MANUAL: triggered from Actions tab
â”‚
â”œâ”€â”€ requests/                     â† ğŸ‘ˆ STUDENTS WORK HERE
â”‚   â”œâ”€â”€ examples/                 â† Read-only reference files
â”‚   â”‚   â”œâ”€â”€ template.yaml         â† Copy this to start
â”‚   â”‚   â”œâ”€â”€ valentina_pvc_detection.yaml
â”‚   â”‚   â”œâ”€â”€ tomas_thickness_study.yaml
â”‚   â”‚   â””â”€â”€ lucia_heritage_study.yaml
â”‚   â””â”€â”€ full_classification.yaml  â† The "official" 12-material run
â”‚
â”œâ”€â”€ results/                      â† ğŸ“Š AUTO-GENERATED by CI
â”‚   â”œâ”€â”€ full_classification/      â† One folder per request
â”‚   â”‚   â”œâ”€â”€ predictions.csv
â”‚   â”‚   â”œâ”€â”€ distributions.png
â”‚   â”‚   â”œâ”€â”€ classification.png
â”‚   â”‚   â””â”€â”€ SUMMARY.md
â”‚   â””â”€â”€ geant4/                   â† Monte Carlo event-level data
â”‚
â”œâ”€â”€ simulation/                   â† Geant4 C++ source code
â”‚   â”œâ”€â”€ CMakeLists.txt
â”‚   â”œâ”€â”€ beamscan.cc
â”‚   â”œâ”€â”€ src/                      â† Physics implementation
â”‚   â”œâ”€â”€ include/                  â† Header files
â”‚   â””â”€â”€ macros/                   â† Geant4 run macros (auto/ for generated)
â”‚
â”œâ”€â”€ analysis/                     â† Python analysis engine
â”‚   â”œâ”€â”€ highland_calculator.py    â† Core: reads YAML â†’ produces plots
â”‚   â””â”€â”€ analyze_geant4.py         â† Compares Geant4 output with Highland
â”‚
â”œâ”€â”€ scripts/                      â† Helper utilities
â”‚   â”œâ”€â”€ generate_macros.py        â† Converts YAML â†’ Geant4 .mac files
â”‚   â””â”€â”€ pseudo_mc.py              â† Gaussian event generator for CI testing
â”‚
â”œâ”€â”€ data/
â”‚   â””â”€â”€ materials_database.json   â† Reference: Xâ‚€, Ï, Î¸â‚€ for all materials
â”‚
â”œâ”€â”€ docs/guides/
â”‚   â””â”€â”€ STUDENT_GUIDE.md          â† Bilingual (Spanish/English) instructions
â”‚
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md                     â† Landing page with quick-start + physics
```

---

## 3. How Each Workflow Works

### Workflow 1: Highland Prediction (automatic)

**Trigger:** Any push or PR that touches `requests/*.yaml`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ highland-predict.yml                                            â”‚
â”‚                                                                 â”‚
â”‚  Job 1: detect-requests                                         â”‚
â”‚    â””â”€ git diff â†’ find changed YAML files â†’ build matrix         â”‚
â”‚                                                                 â”‚
â”‚  Job 2: predict (parallel, one per request file)                â”‚
â”‚    â”œâ”€ pip install numpy matplotlib pyyaml                       â”‚
â”‚    â”œâ”€ python highland_calculator.py <request.yaml>              â”‚
â”‚    â”‚   â”œâ”€ Parse YAML â†’ list of (material, momentum) pairs       â”‚
â”‚    â”‚   â”œâ”€ Highland formula: Î¸â‚€ = (13.6/p)âˆš(x/Xâ‚€)[1+0.038ln()]   â”‚
â”‚    â”‚   â”œâ”€ Generate: distributions.png                           â”‚
â”‚    â”‚   â”œâ”€ Generate: classification.png                          â”‚
â”‚    â”‚   â”œâ”€ Generate: predictions.csv                             â”‚
â”‚    â”‚   â””â”€ Generate: SUMMARY.md (with discrimination matrix)     â”‚
â”‚    â”œâ”€ Upload results as GitHub artifact                         â”‚
â”‚    â””â”€ Post SUMMARY.md as PR comment (if triggered by PR)        â”‚
â”‚                                                                 â”‚
â”‚  Job 3: commit-results (on main branch pushes only)             â”‚
â”‚    â””â”€ Download artifacts â†’ commit to results/ â†’ push            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**What students see:**
- Push a YAML file â†’ 30 seconds later â†’ results appear in PR comment
- Classification plot, distribution overlay, discrimination power matrix
- All without installing anything

### Workflow 2: Geant4 Monte Carlo (manual)

**Trigger:** Manual dispatch from Actions tab (teacher clicks "Run workflow")

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ geant4-simulate.yml                                             â”‚
â”‚                                                                 â”‚
â”‚  Step 1: generate_macros.py                                     â”‚
â”‚    â””â”€ Parse YAML â†’ one .mac file per (material Ã— momentum)      â”‚
â”‚                                                                 â”‚
â”‚  Step 2: Build Geant4 (cached)                                  â”‚
â”‚    â””â”€ cmake + make inside Docker container                      â”‚
â”‚       (or skip if build cache hit)                              â”‚
â”‚                                                                 â”‚
â”‚  Step 3: Run simulations                                        â”‚
â”‚    â”œâ”€ Production: ./beamscan -m <macro.mac> for each config     â”‚
â”‚    â””â”€ CI fallback: pseudo_mc.py (Highland + Gaussian sampling)  â”‚
â”‚       Output: events.csv per configuration                      â”‚
â”‚                                                                 â”‚
â”‚  Step 4: Highland prediction (for comparison)                   â”‚
â”‚    â””â”€ Same highland_calculator.py as Tier 1                     â”‚
â”‚                                                                 â”‚
â”‚  Step 5: Compare Geant4 vs Highland                             â”‚
â”‚    â”œâ”€ analyze_geant4.py: fit distributions, extract Ïƒ           â”‚
â”‚    â”œâ”€ Bar chart: Geant4 Ïƒ_core vs Highland Î¸â‚€                   â”‚
â”‚    â”œâ”€ Overlay: actual Geant4 histograms                         â”‚
â”‚    â””â”€ COMPARISON.md with ratio table                            â”‚
â”‚                                                                 â”‚
â”‚  Step 6: Upload artifacts (60 day retention)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**When Geant4 is NOT actually installed** (GitHub free tier): the workflow falls back to `pseudo_mc.py` which generates Gaussian-sampled events. This lets the full analysis pipeline run and verifies everything works. The comparison will show ratio ~1.0 (since pseudo-MC is Highland-based).

**When Geant4 IS installed** (Docker image or self-hosted runner): the comparison becomes genuinely interesting â€” Geant4 includes MoliÃ¨re scattering tails, Î´-ray production, and energy loss fluctuations that Highland doesn't. Finding Ïƒ_Geant4/Î¸â‚€_Highland â‰  1 is itself a research result.

---

## 4. The Student Experience (Step by Step)

### Day 1: First contact
1. Teacher forks the repo to the team's GitHub organization
2. Each student clones the fork
3. Each student copies `requests/examples/template.yaml` â†’ `requests/myname.yaml`
4. Edits: picks 2â€“3 materials, sets a momentum
5. Pushes â†’ sees Actions run â†’ sees results in 30 seconds

### Day 2â€“3: Exploration
- Students try different material combinations, thicknesses, momenta
- Each student's request file is their own "mini-experiment"
- PR comments accumulate results â†’ team discussion
- Students discover: PE â‰ˆ PP (can't separate!), PVC stands out, minerals scatter more

### Day 4â€“5: Analysis
- Students compare each other's results
- "My 3 GeV run separates PVC better than your 6 GeV run" â†’ discuss 1/p dependence
- Build the full 12-material classification plot together
- Teacher triggers Geant4 run for final validation

### Day 6â€“7: Proposal integration
- Pick the best plots for the proposal
- Write figure captions using the auto-generated SUMMARY.md numbers
- Link the GitHub repo in the proposal ("public, reproducible, anyone can verify")

---

## 5. Geant4 Docker Setup (For Teacher / CI Admin)

### Option A: GitHub self-hosted runner with Geant4

If you have access to a machine with Geant4 installed:

```bash
# On your machine (Linux, macOS, or WSL)
# Install GitHub Actions runner: https://docs.github.com/en/actions/hosting-your-own-runners

# Install Geant4 11.x
# Build the simulation
cd simulation && mkdir build && cd build
cmake .. -DGeant4_DIR=/path/to/geant4/lib/cmake/Geant4
make -j$(nproc)

# Register as self-hosted runner
# Then in the workflow YAML, change runs-on: ubuntu-latest â†’ runs-on: self-hosted
```

### Option B: Docker on GitHub Actions

Add to the Geant4 workflow:
```yaml
jobs:
  simulate:
    runs-on: ubuntu-latest
    container:
      image: geant4/geant4:11.2.2
```

Note: Geant4 Docker images are large (~2 GB). GitHub Actions has a 14 GB disk limit, so this works but pulls take ~3 minutes.

### Option C: Run locally, upload results

Students or teacher runs Geant4 on their own machine:
```bash
cd simulation/build
./beamscan -m ../macros/auto/PE_3.0GeV_10.0mm.mac
# Copy events.csv to results/geant4/ and push
```

**Recommendation: Start with Option C (no infra needed), move to Option B when comfortable.**

---

## 6. What Gets Generated (Output Reference)

### From Highland Calculator

| File | Contents | Format |
|------|----------|--------|
| `predictions.csv` | Î¸â‚€, Î”E, Xâ‚€ for each (material, momentum) | CSV |
| `distributions.png` | Overlaid Gaussian scattering curves | PNG, 200 dpi |
| `classification.png` | 2D fingerprint plot (Î¸â‚€ at pâ‚ vs Î¸â‚€ at pâ‚‚) | PNG, 200 dpi |
| `SUMMARY.md` | Full report with discrimination matrix | Markdown |

### From Geant4 Simulation

| File | Contents | Format |
|------|----------|--------|
| `events.csv` | Per-event: Î¸x, Î¸y, Î¸3d (one file per config) | CSV |
| `geant4_vs_highland.png` | Ïƒ comparison bar chart + distribution overlay | PNG, 200 dpi |
| `COMPARISON.md` | Ïƒ_Geant4 / Î¸â‚€_Highland ratio table | Markdown |

### From Macro Generator

| File | Contents | Format |
|------|----------|--------|
| `<material>_<p>GeV_<x>mm.mac` | Geant4 run macro | Text |
| `run_all.sh` | Shell script to run all macros sequentially | Bash |

---

## 7. Implementation Checklist

### Phase 1: Now â†’ Feb 23 (repo setup)
- [ ] Create GitHub organization for the team
- [ ] Push this repo structure
- [ ] Verify Highland workflow runs on first push
- [ ] Each student does their first request file
- [ ] Celebrate when first plots appear automatically

### Phase 2: Feb 24 â†’ Mar 2 (exploration)
- [ ] Students submit 3â€“5 investigation requests each
- [ ] Run the full_classification.yaml for proposal figures
- [ ] Attempt local Geant4 build (teacher or advanced student)
- [ ] If Geant4 works: run one material, compare with Highland

### Phase 3: Mar 3 â†’ Mar 9 (validation)
- [ ] Trigger Geant4 workflow for the full 12-material set
- [ ] Compare Geant4 vs Highland (look for tail effects)
- [ ] Select best plots for proposal
- [ ] Film 1-minute video showing the repo + automated pipeline

### Phase 4: Mar 10 â†’ Mar 13 (submission)
- [ ] Final proposal text (already written, ~1000 words)
- [ ] Embed chosen figures in DOCX
- [ ] Link GitHub repo in proposal
- [ ] Submit before March 13, 23:59 CEST

---

## 8. Why This Architecture Wins Points

### For the "Scientific Method" criterion
- Predictions BEFORE measurement (Highland â†’ Geant4 â†’ real data)
- Every prediction is versioned, timestamped, reproducible
- Students can explain exactly what they expect to see

### For the "Creativity" criterion
- No other BL4S team will have automated CI/CD for their simulation
- Public GitHub repo = open science (CERN values this)
- Bilingual documentation = inclusivity

### For the "Motivation to Participate" criterion
- Students are ALREADY running simulations before the experiment
- Each student's request file shows individual engagement
- The PR comment trail is a visible record of collaborative science

### For the "Feasibility" criterion
- Highland predictions demonstrate the measurement works
- Geant4 validation adds another layer of confidence
- The discrimination matrix quantifies exactly how many events are needed

---

## 9. Troubleshooting & FAQ

**Q: A student's YAML file breaks the workflow.**
A: GitHub Actions only runs on changed files. Other students' results are not affected. Fix the YAML (usually an indentation error) and re-push.

**Q: Can we add custom materials not in the database?**
A: Yes â€” use any Geant4 NIST material name. The Highland calculator will warn "Unknown material" but Geant4 will handle it. Add the Xâ‚€ value to `MATERIALS_DB` in `highland_calculator.py` for analytical predictions.

**Q: The pseudo-MC comparison shows ratio = 1.0 for everything.**
A: Expected â€” pseudo-MC uses the Highland formula, so it matches by construction. The ratio becomes interesting only with real Geant4 (where MoliÃ¨re tails make Ïƒ_core < Î¸â‚€_Highland).

**Q: How do we get real Geant4 running?**
A: Easiest path: install Geant4 on one machine (teacher's laptop, university server, or a VM). Build the simulation locally. Run macros manually. Upload results to the repo. The analysis pipeline handles the rest.

**Q: Can we run this on a phone/Chromebook?**
A: The Highland predictions run entirely in GitHub's cloud â€” you only need a web browser to edit YAML and view results. No local computation needed.
